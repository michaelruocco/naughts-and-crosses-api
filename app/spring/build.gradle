buildscript {
    ext {
        springBootVersion = "3.4.1"
    }
}

plugins {
    id "naughts-and-crosses-api.java-conventions"
    id "org.springframework.boot" version "${springBootVersion}"
    id "com.gorylenko.gradle-git-properties" version "2.4.2"
}

ext {
    testContainersVersion = "1.20.4"
    awaitilityVersion = "4.2.2"
}
ext["junit-jupiter.version"] = "${junitVersion}"

configurations {
    runtimeOnly.exclude module: "slf4j-simple"
    integrationTestRuntimeOnly.exclude module: "slf4j-simple"
}

dependencies {
    runtimeOnly "org.flywaydb:flyway-database-postgresql:${flywayVersion}"
    implementation project(":entities")
    implementation project(":use-cases")
    implementation project(":api")
    implementation project(":repository")
    implementation project(":rest-client")
    implementation project(":user-provider")
    implementation project(":virus-scanner")
    implementation project(":websocket-client")
    implementation platform("org.springframework.boot:spring-boot-dependencies:${springBootVersion}")
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation "org.springframework.boot:spring-boot-starter-actuator"
    implementation "org.springframework.boot:spring-boot-starter-websocket"
    implementation "org.springframework.boot:spring-boot-starter-oauth2-resource-server"
    implementation "org.springframework.boot:spring-boot-starter-security"
    implementation "org.springframework.boot:spring-boot-starter-jdbc"
    implementation "org.springframework.boot:spring-boot-starter-data-jpa"
    implementation "org.apache.commons:commons-text:${commonsText}"
    implementation "org.postgresql:postgresql:${postgresqlVersion}"
    implementation "org.flywaydb:flyway-core:${flywayVersion}"
    implementation "com.github.michaelruocco:json-adapter:${jsonAdapterVersion}"
    implementation "io.projectreactor.netty:reactor-netty:1.2.2"
    implementation "io.netty:netty-all:4.1.117.Final"

    integrationTestImplementation testFixtures(project(":api"))
    integrationTestImplementation project(":rest-client")
    integrationTestImplementation project(":websocket-client")
    integrationTestImplementation "net.javacrumbs.json-unit:json-unit-assertj:4.1.0"
    integrationTestImplementation "org.awaitility:awaitility:${awaitilityVersion}"

    testFixturesImplementation project(":api")
    testFixturesImplementation project(":rest-client")
    testFixturesImplementation project(":websocket-client")
    testFixturesImplementation project(":user-provider")
    testFixturesImplementation "org.springframework.boot:spring-boot:${springBootVersion}"
    testFixturesImplementation "org.awaitility:awaitility:${awaitilityVersion}"
    testFixturesImplementation "org.testcontainers:postgresql:${testContainersVersion}"
    testFixturesImplementation "org.testcontainers:activemq:${testContainersVersion}"
    testFixturesImplementation "org.testcontainers:mockserver:${testContainersVersion}"
    testFixturesImplementation "org.postgresql:postgresql:${postgresqlVersion}"
    testFixturesImplementation "software.amazon.awssdk:cognitoidentityprovider:${cognitoVersion}"
}

springBoot {
    buildInfo()
}

bootRun {
    systemProperties = System.properties
}

apply from: rootProject.file("publish.gradle")